name: æµ‹è¯• pnpm è®¾ç½®

on:
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘ç”¨äºæµ‹è¯•

jobs:
  test-pnpm-setup:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Install pnpm
      uses: pnpm/action-setup@v3
      with:
        version: 9

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'pnpm'

    - name: Verify pnpm installation
      run: |
        echo "âœ… pnpm version:"
        pnpm --version
        echo "âœ… Node.js version:"
        node --version
        echo "âœ… npm version:"
        npm --version

    - name: Install dependencies
      run: |
        # å°è¯•ä½¿ç”¨frozen-lockfileï¼Œå¦‚æœå¤±è´¥åˆ™ä½¿ç”¨å¸¸è§„å®‰è£…
        pnpm install --frozen-lockfile || pnpm install

    - name: Verify project structure
      run: |
        echo "âœ… é¡¹ç›®æ–‡ä»¶ç»“æ„:"
        ls -la
        echo "âœ… node_modules åˆ›å»ºæˆåŠŸ:"
        ls -la node_modules | head -10

    - name: Run tests
      run: pnpm run test:run

    - name: Build project
      run: pnpm run build

    - name: Verify build output
      run: |
        echo "âœ… æ„å»ºè¾“å‡º:"
        ls -la build/
        echo "âœ… æ„å»ºæˆåŠŸ ğŸ‰"
